{%- liquid
  assign height = section.settings.height
  assign Btop = section.settings.Button_Top | divided_by: 100.0
  assign Bbottm = 1.0 | minus: Btop
-%}

{% style %}
  .comparison-{{ section.id }} {
    height: {{ height }}px;
  }

  @media only screen and (max-width: 768px) {
    .comparison-{{ section.id }} {
      height: {{ height | divided_by: 2 }}px;
    }
  }

/* https://cdn.shopify.com/s/files/1/0737/8396/8032/files/1_DD.png?v=1753260009 */
      /* "type": "image_picker"*/

    /*  asset_url   shopify_asset_url */

    .comparison-{{ section.id }} .comparison__button {
      background-image: url({{ section.settings.Button_Image| img_url }});
      background-size: cover; /* 讓圖片覆蓋整個按鈕區域 */
      background-repeat: no-repeat; /* 防止圖片重複 */
      background-position: center; /* 圖片置中 */
      border: 0px solid #fff;
      top:{{ section.settings.Button_Top }}%;
      height: {{ section.settings.Button_Size }}vw;
      width: {{ section.settings.Button_Size }}vw;
    }

    .comparison-{{ section.id }} .comparison__button::before {
      height: {{ height | times: Btop }}px;
      bottom: {{ section.settings.Button_Size | minus: 0.4 }}vw;
    }

    .comparison-{{ section.id }} .comparison__button::after {
      height: {{ height | times: Bbottm }}px;
      top: {{ section.settings.Button_Size | minus: 0.4 }}vw;
    }

    @media only screen and (max-width: 768px) {
      .comparison-{{ section.id }} .comparison__button::before {
        bottom: {{ section.settings.Button_Size | minus: 0.4 }}vw;
      }

      .comparison-{{ section.id }} .comparison__button::after {
        top: {{ section.settings.Button_Size | minus: 0.4 }}vw;
      }
    }
{% endstyle %}

<div class="index-section">
  {% if section.settings.heading != blank %}
    <div class="section-header page-width">
      <h2 class="{{ section.settings.heading_size }} text-{{ section.settings.heading_position }}">{{ section.settings.heading }}</h2>
    </div>
  {% endif %}
  <div {% unless section.settings.fullwidth %}class="page-width"{% endunless %}>
    <image-compare class="comparison comparison-{{ section.id }} data-section-id="{{ section.id }}">
      {% for block in section.blocks %}
        {% if forloop.index == 1 %}<div class="comparison__draggable" data-draggable>{% endif %}

        {% if block.settings.image != blank %}
          {%- capture image_classes -%}
            comparison__image comparison__image--{{ forloop.index }} {% if block.settings.blur %}blur{% endif %}
          {%- endcapture -%}

          <div class="comparison__image-wrapper"
            {{ block.shopify_attributes }}
            {% if forloop.index == 1 %}data-primary-image{% else %}data-secondary-image{% endif %}
          >
            {% comment %}
              Full width image so don't need to adjust sizes attribute, fallback is 100vw
              We could provide sizes (ex. 50% of viewport) only if we were able to update
              the image markup everytime the slider changed
            {% endcomment %}
            {%- liquid
              if forloop.index == 1
                assign loading = section.settings.lazyload_images
              else
                assign loading = true
              endif
            -%}
            {%- render 'image-element',
              img: block.settings.image,
              img_width: 2000,
              loading: loading,
              classes: image_classes,
            -%}
          </div>
        {% else %}
          {{ 'image' | placeholder_svg_tag: 'placeholder-svg comparison__image' }}
        {% endif %}

        {% if forloop.index == 1 %}</div>{% endif %}
      {% endfor %}
      <button class="comparison__button" data-button>
        {% comment %} <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-chevron-left" viewBox="0 0 284.49 498.98"><title>icon-chevron-left</title><path d="M249.49 0a35 35 0 0 1 24.75 59.75L84.49 249.49l189.75 189.74a35.002 35.002 0 1 1-49.5 49.5L10.25 274.24a35 35 0 0 1 0-49.5L224.74 10.25A34.89 34.89 0 0 1 249.49 0Z"/></svg>
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-chevron-right" viewBox="0 0 284.49 498.98"><title>icon-chevron</title><path d="M35 498.98a35 35 0 0 1-24.75-59.75l189.74-189.74L10.25 59.75a35.002 35.002 0 0 1 49.5-49.5l214.49 214.49a35 35 0 0 1 0 49.5L59.75 488.73A34.89 34.89 0 0 1 35 498.98Z"/></svg> {% endcomment %}
      </button>
    </image-compare>
  </div>
</div>

{% schema %}
{
  "name": "image-compareZeus",
  "class": "image-comparison-section",
  "max_blocks": 2,
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "default": "h2",
      "options": [
        {
          "value": "h3",
          "label": "Small"
        },
        {
          "value": "h2",
          "label": "Medium"
        },
        {
          "value": "h1",
          "label": "Large"
        }
      ]
    },
    {
      "type": "select",
      "id": "heading_position",
      "label": "Heading position",
      "default": "left",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "fullwidth",
      "label": "Full page width",
      "default": true
    },
    {
      "type": "range",
      "id": "height",
      "label": "Height",
      "default": 600,
      "min": 400,
      "max": 900,
      "step": 10,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "lazyload_images",
      "label": "Lazy load images",
      "info": "Lazy loading should be enabled when section images are below the fold.",
      "default": true
    },
    {
      "type": "header",
      "content": "Button styles"
    },
    {
      "type": "image_picker",
      "id": "Button_Image",
      "label": "Button Image"
    },
    {
      "type": "range",
      "id": "Button_Top",
      "label": "Button Top",
      "default": 84,
      "min": 10,
      "max": 90,
      "step": 1,
      "unit": "%"
    },  
    {
      "type": "range",
      "id": "Button_Size",
      "label": "Button Size",
      "default": 10,
      "min": 1,
      "max": 90,
      "step": 1,
      "unit": "vw"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image_picker",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "image-compareZeus",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["footer", "header", "custom.popups"]
  }
}
{% endschema %}
